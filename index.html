<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shadow Shapes - v26.3</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #f3e5f5; font-family: sans-serif; touch-action: none; position: fixed; width: 100%; height: 100%; }
        
        /* åºƒå‘Šæ ï¼š150px (å…±é€šä»•æ§˜) */
        #ad-top, #ad-bottom { position: fixed; left: 0; width: 100%; height: 150px; background: #333; z-index: 100; display: flex; align-items: center; justify-content: center; }
        #ad-top { top: 0; border-bottom: 1px solid #444; } 
        #ad-bottom { bottom: 0; border-top: 1px solid #444; }
        iframe { border: none; width: 100%; height: 150px; background: #333; }

        /* ã‚²ãƒ¼ãƒ æœ¬ä½“ã‚¨ãƒªã‚¢ */
        #game-outer { position: absolute; top: 150px; bottom: 150px; left: 0; right: 0; background: #f3e5f5; overflow: hidden; display: flex; flex-direction: column; }
        #main-container { height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px; position: relative; }
        
        #ui-layer { width: 100%; display: flex; justify-content: space-around; padding: 5px 0; z-index: 10; }
        .ui-box { padding: 4px 15px; border-radius: 15px; font-weight: bold; font-size: 16px; color: #7b1fa2; background: white; box-shadow: 0 2px #ce93d8; }

        #target-display { font-size: 70px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1)); transition: transform 0.3s; margin: 20px 0; }

        #choices { display: flex; gap: 12px; padding: 10px; justify-content: center; width: 100%; }
        .choice-btn { 
            width: 75px; height: 75px; background: #ffffff; 
            border-radius: 15px; display: flex; align-items: center; justify-content: center; 
            font-size: 36px; cursor: pointer; box-shadow: 0 4px #ce93d8; border: 2px solid #7b1fa2;
            -webkit-tap-highlight-color: transparent;
        }
        .choice-btn:active { transform: translateY(2px); box-shadow: 0 2px #ce93d8; }
        .silhouette { filter: brightness(0); }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ */
        #menuScreen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255,255,255,0.96); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 200; 
            padding: 20px 0;
        }

        #ad-middle-container { 
            width: 320px; height: 100px; background: #eee; margin: 15px 0; 
            display: none; justify-content: center; align-items: center; 
            overflow: hidden; flex-shrink: 0; border: 1px solid #ddd;
            transition: opacity 0.3s;
        }

        .menu-btn-group { display: flex; flex-direction: column; align-items: center; width: 100%; gap: 12px; }
        .menu-btn { width: 240px; padding: 15px; font-size: 18px; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; text-decoration: none; text-align: center; transition: 0.2s; }
        #retry-btn { background: #9c27b0; color: white; box-shadow: 0 4px #7b1fa2; }
        #retry-btn:disabled { background: #ccc; color: #888; box-shadow: none; cursor: default; }
        #more-games-btn { background: #ff4081; color: white; box-shadow: 0 4px #c2185b; }

        /* å¤§åºƒå‘Šç”¨ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä»˜ã */
        #bigAdScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 3000; display: none; justify-content: center; align-items: center; }
        .ad-frame-wrapper { width: 95%; height: 85%; position: relative; }
        .ad-close-btn { 
            position: absolute; top: -15px; right: -15px; 
            color: white; font-size: 22px; font-weight: bold; 
            cursor: pointer; background: rgba(0,0,0,0.8); 
            width: 44px; height: 44px; border-radius: 50%; 
            display: none; align-items: center; justify-content: center; 
            z-index: 3100; border: 2px solid white; font-family: sans-serif;
        }
    </style>
</head>
<body>

    <div id="ad-top"><iframe id="frame-top" src="./ad.html?pos=top"></iframe></div>

    <div id="game-outer">
        <div id="main-container">
            <div id="ui-layer">
                <div id="score-display" class="ui-box">SCORE: 0</div>
                <div id="timer-display" class="ui-box">TIME: 5.0</div>
            </div>
            
            <div style="font-weight:bold; color:#7b1fa2; margin-top: 10px; font-size: 14px;">åŒã˜å½¢ã®ã€Œå½±ã€ã‚’é¸ã¹ï¼</div>
            <div id="target-display">â“</div>
            <div id="choices"></div>

            <div id="menuScreen">
                <h2 id="result-msg" style="color:#7b1fa2; margin: 10px 0; font-size: 24px; text-align: center;">Shadow Shapes</h2>
                <p id="sub-msg" style="font-size: 13px; color: #666; margin: 0 0 10px 0; text-align: center;">ã‚«ãƒ©ãƒ¼ã®å›³å½¢ã¨åŒã˜å½¢ã®å½±ã‚’ã‚¿ãƒƒãƒ—ï¼</p>
                
                <div id="ad-middle-container">
                    <div id="im-8b492cea6667490da71c488bdcc7cfc8">
                        <script async src="https://imp-adedge.i-mobile.co.jp/script/v1/spot.js?20220104"></script>
                        <script>(window.adsbyimobile=window.adsbyimobile||[]).push({pid:84561,mid:590804,asid:1924211,type:"banner",display:"inline",elementid:"im-8b492cea6667490da71c488bdcc7cfc8"})</script>
                    </div>
                </div>

                <div class="menu-btn-group">
                    <button id="retry-btn" class="menu-btn" onclick="startNewGame()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
                    <a href="https://saaaachi.github.io/" id="more-games-btn" class="menu-btn">ä»–ã®ã‚²ãƒ¼ãƒ ã¯ã“ã¡ã‚‰</a>
                </div>
            </div>

            <div id="bigAdScreen">
                <div class="ad-frame-wrapper">
                    <div id="ad-close-btn" class="ad-close-btn" onclick="closeBigAd()"></div>
                    <iframe id="ad-large-frame" src="" style="width:100%; height:100%; border:none;"></iframe>
                </div>
            </div>
        </div>
    </div>

    <div id="ad-bottom"><iframe id="frame-bottom" src="./ad.html?pos=bottom"></iframe></div>

    <script>
        let score = 0, gameActive = false, timeLeft = 5.0, timer, playCount = 0;
        const shapes = ['â­', 'â¤ï¸', 'ğŸŒ™', 'â˜ï¸', 'â˜€ï¸', 'ğŸŒ¸', 'ğŸ’', 'ğŸ€', 'ğŸ', 'ğŸ±', 'ğŸ¦‹', 'ğŸ˜', 'ğŸ ', 'ğŸš—', 'ğŸ””', 'ğŸ€'];
        let targetShape = "";

        const menuScreen = document.getElementById("menuScreen");
        const adMid = document.getElementById("ad-middle-container");
        const resultMsg = document.getElementById("result-msg");
        const retryBtn = document.getElementById("retry-btn");
        const targetDisplay = document.getElementById("target-display");
        const choicesDiv = document.getElementById("choices");

        function startNewGame() {
            menuScreen.style.display = "none";
            adMid.style.display = "none";
            score = 0; gameActive = true;
            nextLevel();
        }

        function nextLevel() {
            if(!gameActive) return;
            timeLeft = Math.max(1.1, 5.0 - (score * 0.18));
            updateUI();
            
            targetShape = shapes[Math.floor(Math.random() * shapes.length)];
            targetDisplay.innerText = targetShape;
            
            const rotations = [0, 90, 180, 270];
            targetDisplay.style.transform = `rotate(${rotations[Math.floor(Math.random()*4)]}deg)`;

            choicesDiv.innerHTML = "";
            const currentChoices = [targetShape];
            while(currentChoices.length < 3) {
                const s = shapes[Math.floor(Math.random() * shapes.length)];
                if(!currentChoices.includes(s)) currentChoices.push(s);
            }
            currentChoices.sort(() => Math.random() - 0.5);

            currentChoices.forEach(s => {
                const btn = document.createElement("button");
                btn.className = "choice-btn";
                btn.innerHTML = `<span class="silhouette">${s}</span>`;
                btn.onpointerdown = (e) => { e.preventDefault(); check(s); };
                choicesDiv.appendChild(btn);
            });

            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft -= 0.1;
                updateUI();
                if(timeLeft <= 0) gameOver("æ™‚é–“åˆ‡ã‚Œï¼â³");
            }, 100);
        }

        function check(s) {
            if(!gameActive) return;
            if(s === targetShape) {
                score++;
                nextLevel();
            } else {
                gameOver("å½¢ãŒã¡ãŒã†ã‚ˆï¼ğŸ˜±");
            }
        }

        function updateUI() {
            document.getElementById("score-display").innerText = "SCORE: " + score;
            document.getElementById("timer-display").innerText = "TIME: " + Math.max(0, timeLeft).toFixed(1);
        }

        function gameOver(msg) {
            gameActive = false;
            playCount++;
            clearInterval(timer);

            // --- âœ¨ èª¤ã‚¿ãƒƒãƒ—é˜²æ­¢ã‚¬ãƒ¼ãƒ‰ç™ºå‹• (1.5ç§’) ---
            retryBtn.innerText = "ãŠå¾…ã¡ãã ã•ã„...";
            retryBtn.disabled = true;
            adMid.style.display = "flex";
            adMid.style.pointerEvents = "none";
            adMid.style.opacity = "0.4";

            resultMsg.innerText = "GAME OVER";
            document.getElementById("sub-msg").innerText = msg + "\nSCORE: " + score;
            menuScreen.style.display = "flex";
            menuScreen.scrollTop = 0;

            setTimeout(() => {
                adMid.style.pointerEvents = "auto";
                adMid.style.opacity = "1";
                retryBtn.disabled = false;
                retryBtn.innerText = "ã‚‚ã†ä¸€åº¦éŠã¶";
            }, 1500);

            // å¤§åºƒå‘Šåˆ¤å®š
            if (playCount === 3 || (playCount > 3 && (playCount - 3) % 7 === 0)) {
                setTimeout(showBigAd, 500);
            }
        }

        function showBigAd() {
            const screen = document.getElementById("bigAdScreen");
            const closeBtn = document.getElementById("ad-close-btn");
            document.getElementById("ad-large-frame").src = "./ad.large.html?t=" + Date.now();
            screen.style.display = "flex";
            
            let countdown = 5;
            closeBtn.style.display = "flex";
            closeBtn.innerText = countdown;
            closeBtn.style.pointerEvents = "none";
            closeBtn.style.opacity = "0.7";

            const timerInt = setInterval(() => {
                countdown--;
                closeBtn.innerText = countdown;
                if (countdown <= 0) {
                    clearInterval(timerInt);
                    closeBtn.innerText = "Ã—";
                    closeBtn.style.pointerEvents = "auto";
                    closeBtn.style.opacity = "1";
                }
            }, 1000);
        }

        function closeBigAd() {
            document.getElementById("bigAdScreen").style.display = "none";
            document.getElementById("ad-large-frame").src = "";
        }

        // åºƒå‘Šãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ (30ç§’äº¤äº’)
        setInterval(() => {
            const f = document.getElementById('frame-top');
            if(f) f.src = "./ad.html?pos=top&t=" + Date.now();
        }, 30000);
        setTimeout(() => {
            setInterval(() => {
                const f = document.getElementById('frame-bottom');
                if(f) f.src = "./ad.html?pos=bottom&t=" + Date.now();
            }, 30000);
        }, 15000);

        window.onload = () => { menuScreen.style.display = "flex"; };
    </script>
</body>
</html>
